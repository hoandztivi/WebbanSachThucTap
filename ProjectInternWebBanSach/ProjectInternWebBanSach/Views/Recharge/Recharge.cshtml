@using System.Security.Claims

@{
    ViewData["Title"] = "Nạp tiền";
    var currentUserId = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
}

@section Styles {
    <link rel="stylesheet" href="~/css/recharge.css" asp-append-version="true" />
}

<div id="rechargeRoot"
     data-user-id="@ViewBag.UserId"
     class="py-8 px-4">
    <div class="max-w-5xl mx-auto">

        <!-- CARD GỘP TẤT CẢ -->
        <div class="recharge-card bg-white rounded-2xl shadow-lg border border-gray-100 p-6 md:p-8">
            <div class="grid md:grid-cols-2 gap-8">

                <!-- Cột trái: Thông tin ngân hàng + QR -->
                <div class="space-y-6">

                    <!-- Thông tin tài khoản -->
                    <section>
                        <h2 class="section-title">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z" />
                            </svg>
                            Thông tin tài khoản
                        </h2>

                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-xl">
                                <div class="flex-1">
                                    <p class="text-xs text-gray-500 mb-1">Số tài khoản</p>
                                    <p id="bankAccount" class="text-lg font-bold text-gray-900">0325899425</p>
                                    <p class="text-xs text-gray-500 mt-1">Ngân hàng: Vietinbank</p>
                                </div>
                                <button type="button"
                                        onclick="copyText('0325899425','Đã copy số tài khoản')"
                                        class="btn-orange">
                                    Copy
                                </button>
                            </div>

                            <div class="p-4 bg-gray-50 rounded-xl">
                                <p class="text-xs text-gray-500 mb-1">Chủ tài khoản</p>
                                <p class="text-base font-semibold text-gray-900">Lê Quí Hoàn</p>
                            </div>

                            <div class="p-4 bg-orange-50 border border-orange-200 rounded-xl">
                                <p class="text-xs text-orange-700 font-medium mb-2">Nội dung chuyển khoản</p>
                                <div class="flex items-center gap-3">
                                    <code id="transferCode"
                                          class="flex-1 text-lg font-bold text-orange-600 tracking-wider bg-white px-3 py-2 rounded-lg overflow-x-auto">
                                        —
                                    </code>
                                    <button type="button" id="btnCopyCode" class="btn-orange whitespace-nowrap">
                                        Copy
                                    </button>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- QR Thanh toán -->
                    <section class="space-y-4">
                        <div class="flex items-center justify-between">
                            <h2 class="section-title !mb-0">
                                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                                </svg>
                                Mã QR thanh toán
                            </h2>
                            <span class="inline-flex items-center px-3 py-1 text-xs font-semibold text-white bg-orange-500 rounded-full">
                                Quét mã để nạp tiền
                            </span>
                        </div>

                        <!-- QR nằm DƯỚI dòng “Quét mã để nạp tiền” -->
                        <div class="flex justify-center">
                            <div class="qr-wrapper">
                                <img id="qrImg"
                                     class="hidden w-full h-full object-contain rounded-lg"
                                     alt="QR Code" />
                                <div id="qrPlaceholder" class="qr-placeholder">
                                    <svg class="w-14 h-14 text-gray-300 mx-auto mb-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                                    </svg>
                                    <p class="text-gray-400 text-sm font-medium">Chưa tạo mã QR</p>
                                    <p class="text-gray-400 text-xs mt-1">Vui lòng nhập số tiền và bấm "Tạo mã QR"</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex flex-wrap items-center gap-2 justify-center text-xs text-gray-600">
                            <div class="flex items-center gap-2 px-3 py-1 bg-gray-50 rounded-lg">
                                <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                                <span>Hạn: <span id="expiredAt" class="font-semibold text-gray-900">—</span></span>
                            </div>

                            <div class="flex items-center gap-2 px-3 py-1 bg-blue-50 rounded-lg">
                                <span class="w-2 h-2 bg-blue-500 rounded-full animate-pulse"></span>
                                <span>Trạng thái: <span id="statusText" class="font-semibold text-blue-600">—</span></span>
                            </div>
                        </div>
                    </section>
                </div>

                <!-- Cột phải: Form + hướng dẫn -->
                <div class="space-y-6">

                    <!-- Form tạo QR -->
                    <section>
                        <h2 class="section-title">
                            <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                      d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                            </svg>
                            Tạo mã QR thanh toán
                        </h2>

                        <form id="rechargeForm" asp-antiforgery="true" class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-3">
                                    Số tiền cần nạp
                                </label>

                                <!-- Quick buttons -->
                                <div class="grid grid-cols-3 gap-2 mb-3">
                                    <button type="button" onclick="setAmount(50000)" class="quick-btn">50K</button>
                                    <button type="button" onclick="setAmount(100000)" class="quick-btn">100K</button>
                                    <button type="button" onclick="setAmount(200000)" class="quick-btn">200K</button>
                                    <button type="button" onclick="setAmount(500000)" class="quick-btn">500K</button>
                                    <button type="button" onclick="setAmount(1000000)" class="quick-btn">1M</button>
                                    <button type="button" onclick="setAmount(2000000)" class="quick-btn">2M</button>
                                </div>

                                <div class="relative">
                                    <input id="amountInput" type="number"
                                           class="amount-input"
                                           value="50000" min="50000" step="10000" required
                                           placeholder="Nhập số tiền..." />
                                    <span class="amount-suffix">VND</span>
                                </div>
                                <p class="mt-1 text-xs text-gray-500">
                                    Tối thiểu: <span class="font-semibold text-orange-600">50.000 VND</span>
                                </p>
                            </div>

                            <div class="flex flex-wrap gap-3">
                                <button type="submit" id="btnCreateQr"
                                        class="btn-orange btn-sm flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z" />
                                    </svg>
                                    Tạo mã QR
                                </button>

                                <button type="button" id="btnConfirm"
                                        class="btn-confirm flex items-center justify-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                              d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                    Xác nhận thanh toán
                                </button>

                                <button type="button" id="btnReset"
                                        class="px-4 py-2 rounded-xl border border-gray-200 text-sm font-semibold text-gray-700 hover:bg-gray-50">
                                    Reset
                                </button>
                            </div>
                        </form>

                    </section>

                    <!-- Hướng dẫn -->
                    <section class="note-card note-blue">
                        <h3 class="note-title text-blue-900">Hướng dẫn nạp tiền</h3>
                        <ol class="note-list text-blue-900">
                            <li>Nhập số tiền cần nạp (tối thiểu 50.000 VND)</li>
                            <li>Bấm <strong>Tạo mã QR</strong></li>
                            <li>Quét mã bằng app ngân hàng / ví điện tử</li>
                            <li>Giữ nguyên nội dung chuyển khoản hệ thống tạo sẵn</li>
                        </ol>
                    </section>

                    <!-- Lưu ý -->
                    <section class="note-card note-red">
                        <h3 class="note-title text-red-900">Lưu ý quan trọng</h3>
                        <ul class="note-list text-red-900">
                            <li>Điền <strong>đúng</strong> nội dung chuyển khoản để hệ thống tự cộng tiền.</li>
                            <li>Không nhận giao dịch từ tài khoản công ty.</li>
                            <li>Tiền sẽ được cộng sau khoảng 1–3 phút.</li>
                        </ul>
                    </section>
                </div>

            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="~/js/recharge.js" asp-append-version="true"></script>
}
